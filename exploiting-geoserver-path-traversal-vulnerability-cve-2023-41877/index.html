<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>Exploiting GeoServer path traversal vulnerability (CVE-2023-41877) - Raptor Blog</title><meta name=Description content="Post about exploiting Geoserver CVE-2023-41877 to get RCE"><meta property="og:title" content="Exploiting GeoServer path traversal vulnerability (CVE-2023-41877)"><meta property="og:description" content="Post about exploiting Geoserver CVE-2023-41877 to get RCE"><meta property="og:type" content="article"><meta property="og:url" content="https://blog.anthares101.com/exploiting-geoserver-path-traversal-vulnerability-cve-2023-41877/"><meta property="og:image" content="https://blog.anthares101.com/exploiting-geoserver-path-traversal-vulnerability-CVE-2023-41877/images/banner.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-03-20T00:00:00+00:00"><meta property="article:modified_time" content="2024-06-03T00:00:00+00:00"><meta property="og:site_name" content="Raptor Blog"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://blog.anthares101.com/exploiting-geoserver-path-traversal-vulnerability-CVE-2023-41877/images/banner.png"><meta name=twitter:title content="Exploiting GeoServer path traversal vulnerability (CVE-2023-41877)"><meta name=twitter:description content="Post about exploiting Geoserver CVE-2023-41877 to get RCE"><meta name=application-name content="Raptor Blog"><meta name=apple-mobile-web-app-title content="Raptor Blog"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://blog.anthares101.com/exploiting-geoserver-path-traversal-vulnerability-cve-2023-41877/><link rel=prev href=https://blog.anthares101.com/time-based-user-enumeration-in-apache-guacamole/><link rel=stylesheet href=/css/style.min.css><link rel=preload href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css></noscript><link rel=preload href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Exploiting GeoServer path traversal vulnerability (CVE-2023-41877)","inLanguage":"en","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/blog.anthares101.com\/exploiting-geoserver-path-traversal-vulnerability-cve-2023-41877\/"},"image":["https:\/\/blog.anthares101.com\/banner.png"],"genre":"posts","keywords":"cve, red team, exploit, geoserver","wordcount":591,"url":"https:\/\/blog.anthares101.com\/exploiting-geoserver-path-traversal-vulnerability-cve-2023-41877\/","datePublished":"2024-03-20T00:00:00+00:00","dateModified":"2024-06-03T00:00:00+00:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"Anthares101"},"description":"Post about exploiting Geoserver CVE-2023-41877 to get RCE"}</script><script defer src=https://static.cloudflareinsights.com/beacon.min.js data-cf-beacon='{"token": "0eec0c6a58a84bcea4130feee244a950"}'></script></head><body data-header-desktop=fixed data-header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"dark"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"dark"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="Raptor Blog"><span class=header-title-pre><i class='fa-solid fa-flag'></i></span>Raptor Blog</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>Posts </a><a class=menu-item href=/tags/>Tags </a><a class=menu-item href=/categories/>Categories </a><a class=menu-item href=https://github.com/anthares101/raptor-blog title="Check the code!" rel="noopener noreffer" target=_blank><i class='fab fa-github fa-fw' aria-hidden=true></i> </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder="Search titles or contents..." id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=Search><i class="fas fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=Clear><i class="fas fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span>
</span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme"><i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="Raptor Blog"><span class=header-title-pre><i class='fa-solid fa-flag'></i></span>Raptor Blog</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder="Search titles or contents..." id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=Search><i class="fas fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=Clear><i class="fas fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>Cancel</a></div><a class=menu-item href=/posts/ title>Posts</a><a class=menu-item href=/tags/ title>Tags</a><a class=menu-item href=/categories/ title>Categories</a><a class=menu-item href=https://github.com/anthares101/raptor-blog title="Check the code!" rel="noopener noreffer" target=_blank><i class='fab fa-github fa-fw' aria-hidden=true></i></a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>Contents</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Exploiting GeoServer path traversal vulnerability (CVE-2023-41877)</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=/posts/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>Anthares101</a></span>&nbsp;<span class=post-category>included in <a href=/categories/offensive-cybersecurity/><i class="far fa-folder fa-fw" aria-hidden=true></i>Offensive Cybersecurity</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw" aria-hidden=true></i>&nbsp;<time datetime=2024-03-20>2024-03-20</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden=true></i>&nbsp;591 words&nbsp;
<i class="far fa-clock fa-fw" aria-hidden=true></i>&nbsp;3 minutes&nbsp;</div></div><div class=featured-image><img class=lazyload src=/svg/loading.min.svg data-src=/exploiting-geoserver-path-traversal-vulnerability-cve-2023-41877/images/banner.png data-srcset="/exploiting-geoserver-path-traversal-vulnerability-cve-2023-41877/images/banner.png, /exploiting-geoserver-path-traversal-vulnerability-cve-2023-41877/images/banner.png 1.5x, /exploiting-geoserver-path-traversal-vulnerability-cve-2023-41877/images/banner.png 2x" data-sizes=auto alt=/exploiting-geoserver-path-traversal-vulnerability-cve-2023-41877/images/banner.png title="Post about exploiting Geoserver CVE-2023-41877 to get RCE" width=918 height=290></div><div class="details toc" id=toc-static data-kept=true><div class="details-summary toc-title"><span>Contents</span>
<span><i class="details-icon fas fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#what-is-geoserver>What is Geoserver?</a></li><li><a href=#the-vulnerability>The vulnerability</a><ul><li><a href=#description>Description</a></li><li><a href=#is-rce-possible>Is RCE possible?</a></li><li><a href=#proof-of-concept>Proof of concept</a></li></ul></li><li><a href=#mitigation>Mitigation</a></li><li><a href=#references>References</a></li></ul></nav></div></div><div class=content id=content><h1 id=exploiting-geoserver-path-traversal-vulnerability-cve-2023-41877>Exploiting GeoServer path traversal vulnerability (CVE-2023-41877)</h1><p>Before starting, remember that performing any of the attacks explained in this post to networks without previous consent is illegal, this post information is for educational purposes only.</p><h2 id=what-is-geoserver>What is Geoserver?</h2><p><a href=https://github.com/geoserver/geoserver target=_blank rel="noopener noreffer">Geoserver</a> is an open-source software server written in Java that allows users to share and edit geospatial data. Designed for interoperability, it publishes data from any major spatial data source using open standards.</p><h2 id=the-vulnerability>The vulnerability</h2><h3 id=description>Description</h3><p><strong>NOTE: <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2023-41877" target=_blank rel="noopener noreffer">CVE-2023-41877</a> states that only Geoserver versions 2.23.4 and prior are affected, this is not true. All Geoserver versions until this day are vulnerable if proper mitigation is not applied!</strong></p><p>At the time of writting this article, all Geoserver versions allows privileged users to change the location of the application log file to any path in the host system as long as the user running the application has enough permissions to read the chosen path. If the Geoserver user also has write permissions, the application will even create a new file and the needed directories to match the log path set in the configuration.</p><p>Abusing the commented behaviour, a Geoserver administrator could both read system files or even overwrite them if the user running Geoserver has enough permissions. The next image shows how after changing the log file location to <code>/etc/passwd</code>, the application leaks its contents:</p><img src=images/passwd-file.png alt="Image of Geoserver leaking /etc/passwd file"><h3 id=is-rce-possible>Is RCE possible?</h3><p>If Geoserver is deployed using Tomcat the answer is probably yes! In case of the other deployment method, Jetty, RCE may still be possible but it would require a bit more imagination like abusing another services running.</p><p>Focusing on Tomcat the idea is simple, changing the log file path to a index.jsp inside a subdirectory under <code>webapps</code> directory will trigger a new application deployment by the servlet container. At this point, an attacker could inject a webshell in the logs and, by accessing the application deployed before, it would get code execution. Why this work with Tomcat and not with Jetty? Even though Jetty is also a servlet container, it does not support JSP files execution by default so this attack vector is mitigated.</p><h3 id=proof-of-concept>Proof of concept</h3><p>First of all, it is necessary to get access to the administration panel, so a privileged account is needed. Also, as mention before, the Geoserver application needs to be running on top of Tomcat.</p><p>The Geoserver administration panel offers the option to change the location of the log file to a path selected by an administrator in Global settings page.</p><img src=images/log-config.png alt="Image of Geoserver log configuration"><p>By changing that path to something like <code>../../pwned/index.jsp</code>, a new directory called &ldquo;pwned&rdquo; is created in the webapps Tomcat directory. Checking the Tomcat logs it is possible to see that a new application called &ldquo;pwned&rdquo; has been deployed.</p><img src=images/pwned-deployed.png alt="Image of a new JSP application being deployed"><p>Inside that new directory, the file <code>index.jsp</code> is now used by Geoserver to store its logs. Using the default logging profile of Geoserver, a JSP webshell could be injected to the logs by forcing an error with a request to the Geoserver API.</p><img src=images/injecting-webshell.png alt="Image of a GET request being made to the Geoserver API injecting a JSP webshell into the logs">
<img src=images/webshell-injected.png alt="Image showing that a JSP webshell was injected in the Geoserver logs"><p>Visiting the new application deployed at <code>http://localhost/pwned/</code> with the GET parameter <code>cmd</code> set to a system command would allow an attacker to execute arbitrary code on the server.</p><img src=images/rce.png alt="Image showing how RCE is achieved"><p>As can be seen, the injected JSP code is not displayed as part of the response since it is being executed.</p><h2 id=mitigation>Mitigation</h2><p>The only mitigation available is to define <code>GEOSERVER_LOG_FILE</code> as system property, environment variable, or servlet context parameter, preventing the UI global setting provided from being used.</p><p>A note about this was included in the <a href=https://docs.geoserver.org/latest/en/user/production/config.html#logging-configuration-hardening target=_blank rel="noopener noreffer">official Geoserver documentation</a> to help with the hardening of production systems.</p><h2 id=references>References</h2><ul><li><a href=https://github.com/geoserver/geoserver target=_blank rel="noopener noreffer">https://github.com/geoserver/geoserver</a></li><li><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2023-41877" target=_blank rel="noopener noreffer">https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2023-41877</a></li><li><a href=https://github.com/geoserver/geoserver/security/advisories/GHSA-8g7v-vjrc-x4g5 target=_blank rel="noopener noreffer">https://github.com/geoserver/geoserver/security/advisories/GHSA-8g7v-vjrc-x4g5</a></li><li><a href=https://docs.geoserver.org/latest/en/user/production/config.html#logging-configuration-hardening target=_blank rel="noopener noreffer">https://docs.geoserver.org/latest/en/user/production/config.html#logging-configuration-hardening</a></li><li><a href=https://github.com/geoserver/geoserver/pull/7144 target=_blank rel="noopener noreffer">https://github.com/geoserver/geoserver/pull/7144</a></li></ul></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>Updated on 2024-06-03</span></div></div><div class=post-info-line><div class=post-info-md><span><a class=link-to-markdown href=/exploiting-geoserver-path-traversal-vulnerability-cve-2023-41877/index.md target=_blank>Read Markdown</a></span></div><div class=post-info-share><span><a href=javascript:void(0); title="Share on Twitter" data-sharer=twitter data-url=https://blog.anthares101.com/exploiting-geoserver-path-traversal-vulnerability-cve-2023-41877/ data-title="Exploiting GeoServer path traversal vulnerability (CVE-2023-41877)" data-via=@Anthares101 data-hashtags="cve,red team,exploit,geoserver"><i class="fab fa-twitter fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Facebook" data-sharer=facebook data-url=https://blog.anthares101.com/exploiting-geoserver-path-traversal-vulnerability-cve-2023-41877/ data-hashtag=cve><i class="fab fa-facebook-square fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Linkedin" data-sharer=linkedin data-url=https://blog.anthares101.com/exploiting-geoserver-path-traversal-vulnerability-cve-2023-41877/><i class="fab fa-linkedin fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw" aria-hidden=true></i>&nbsp;<a href=/tags/cve/>cve</a>,&nbsp;<a href=/tags/red-team/>red team</a>,&nbsp;<a href=/tags/exploit/>exploit</a>,&nbsp;<a href=/tags/geoserver/>geoserver</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>Back</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span></section></div><div class=post-nav><a href=/time-based-user-enumeration-in-apache-guacamole/ class=prev rel=prev title="Time based user enumeration in Apache Guacamole"><i class="fas fa-angle-left fa-fw" aria-hidden=true></i>Time based user enumeration in Apache Guacamole</a></div></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><i class="far fa-copyright fa-fw" aria-hidden=true></i><span itemprop=copyrightYear>2023 - 2024</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=/posts/ target=_blank>Anthares101</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i>
</a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.css><script type=text/javascript src=https://cdn.jsdelivr.net/npm/autocomplete.js@0.38.1/dist/autocomplete.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lunr@2.3.9/lunr.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/auto-render.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/copy-tex.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/mhchem.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"Copy to clipboard",maxShownLines:50},comment:{},math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!0,left:"\\begin{equation}",right:"\\end{equation}"},{display:!0,left:"\\begin{equation*}",right:"\\end{equation*}"},{display:!0,left:"\\begin{align}",right:"\\end{align}"},{display:!0,left:"\\begin{align*}",right:"\\end{align*}"},{display:!0,left:"\\begin{alignat}",right:"\\end{alignat}"},{display:!0,left:"\\begin{alignat*}",right:"\\end{alignat*}"},{display:!0,left:"\\begin{gather}",right:"\\end{gather}"},{display:!0,left:"\\begin{CD}",right:"\\end{CD}"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},search:{highlightTag:"em",lunrIndexURL:"/index.json",maxResultLength:10,noResultsFound:"No results found",snippetLength:30,type:"lunr"}}</script><script type=text/javascript src=/js/theme.min.js></script></body></html>