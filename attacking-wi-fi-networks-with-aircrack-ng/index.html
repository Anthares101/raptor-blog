<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>Attacking Wi-Fi networks with Aircrack-ng - Raptor Blog</title><meta name=Description content="Post about how Wi-Fi networks can be attacked with the Aircrack-ng suite"><meta property="og:title" content="Attacking Wi-Fi networks with Aircrack-ng"><meta property="og:description" content="Post about how Wi-Fi networks can be attacked with the Aircrack-ng suite"><meta property="og:type" content="article"><meta property="og:url" content="https://blog.anthares101.com/attacking-wi-fi-networks-with-aircrack-ng/"><meta property="og:image" content="https://blog.anthares101.com/attacking-wi-fi-networks-with-aircrack-ng/images/banner.jpg"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-09-12T00:00:00+00:00"><meta property="article:modified_time" content="2022-12-25T00:00:00+00:00"><meta property="og:site_name" content="Raptor Blog"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://blog.anthares101.com/attacking-wi-fi-networks-with-aircrack-ng/images/banner.jpg"><meta name=twitter:title content="Attacking Wi-Fi networks with Aircrack-ng"><meta name=twitter:description content="Post about how Wi-Fi networks can be attacked with the Aircrack-ng suite"><meta name=application-name content="Raptor Blog"><meta name=apple-mobile-web-app-title content="Raptor Blog"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://blog.anthares101.com/attacking-wi-fi-networks-with-aircrack-ng/><link rel=prev href=https://blog.anthares101.com/magi-project/><link rel=next href=https://blog.anthares101.com/dns-tunneling/><link rel=stylesheet href=/css/style.min.css><link rel=preload href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css></noscript><link rel=preload href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Attacking Wi-Fi networks with Aircrack-ng","inLanguage":"en","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/blog.anthares101.com\/attacking-wi-fi-networks-with-aircrack-ng\/"},"image":["https:\/\/blog.anthares101.com\/banner.png"],"genre":"posts","keywords":"wifi, red team, network","wordcount":2881,"url":"https:\/\/blog.anthares101.com\/attacking-wi-fi-networks-with-aircrack-ng\/","datePublished":"2022-09-12T00:00:00+00:00","dateModified":"2022-12-25T00:00:00+00:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"Anthares101"},"description":"Post about how Wi-Fi networks can be attacked with the Aircrack-ng suite"}</script><script defer src=https://static.cloudflareinsights.com/beacon.min.js data-cf-beacon='{"token": "0eec0c6a58a84bcea4130feee244a950"}'></script></head><body data-header-desktop=fixed data-header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"dark"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"dark"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="Raptor Blog"><span class=header-title-pre><i class='fa-solid fa-flag'></i></span>Raptor Blog</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>Posts </a><a class=menu-item href=/tags/>Tags </a><a class=menu-item href=/categories/>Categories </a><a class=menu-item href=https://github.com/anthares101/raptor-blog title="Check the code!" rel="noopener noreffer" target=_blank><i class='fab fa-github fa-fw' aria-hidden=true></i> </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder="Search titles or contents..." id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=Search><i class="fas fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=Clear><i class="fas fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span>
</span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme"><i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="Raptor Blog"><span class=header-title-pre><i class='fa-solid fa-flag'></i></span>Raptor Blog</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder="Search titles or contents..." id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=Search><i class="fas fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=Clear><i class="fas fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>Cancel</a></div><a class=menu-item href=/posts/ title>Posts</a><a class=menu-item href=/tags/ title>Tags</a><a class=menu-item href=/categories/ title>Categories</a><a class=menu-item href=https://github.com/anthares101/raptor-blog title="Check the code!" rel="noopener noreffer" target=_blank><i class='fab fa-github fa-fw' aria-hidden=true></i></a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>Contents</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Attacking Wi-Fi networks with Aircrack-ng</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=/posts/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>Anthares101</a></span>&nbsp;<span class=post-category>included in <a href=/categories/offensive-cybersecurity/><i class="far fa-folder fa-fw" aria-hidden=true></i>Offensive Cybersecurity</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw" aria-hidden=true></i>&nbsp;<time datetime=2022-09-12>2022-09-12</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden=true></i>&nbsp;2881 words&nbsp;
<i class="far fa-clock fa-fw" aria-hidden=true></i>&nbsp;14 minutes&nbsp;</div></div><div class=featured-image><img class=lazyload src=/svg/loading.min.svg data-src=/attacking-wi-fi-networks-with-aircrack-ng/images/banner.jpg data-srcset="/attacking-wi-fi-networks-with-aircrack-ng/images/banner.jpg, /attacking-wi-fi-networks-with-aircrack-ng/images/banner.jpg 1.5x, /attacking-wi-fi-networks-with-aircrack-ng/images/banner.jpg 2x" data-sizes=auto alt=/attacking-wi-fi-networks-with-aircrack-ng/images/banner.jpg title="Post about how Wi-Fi networks can be attacked with the Aircrack-ng suite" width=6000 height=4000></div><div class="details toc" id=toc-static data-kept=true><div class="details-summary toc-title"><span>Contents</span>
<span><i class="details-icon fas fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#introduction>Introduction</a></li><li><a href=#capturing-traffic>Capturing traffic</a></li><li><a href=#wep>WEP</a><ul><li><a href=#how-encryption-works>How encryption works?</a></li><li><a href=#authentication>Authentication</a></li><li><a href=#main-flaws>Main flaws</a></li><li><a href=#attacks>Attacks</a><ul><li><a href=#deauthentication-attack>Deauthentication Attack</a></li><li><a href=#arp-replay-attacks>ARP Replay Attacks</a></li><li><a href=#cracking-the-key-pwt-technique>Cracking the key (PWT technique)</a><ul><li><a href=#korek-technique>KoreK technique</a></li></ul></li><li><a href=#clientless-wep-cracking>Clientless WEP cracking</a></li><li><a href=#bypassing-shared-key-authentication-ska>Bypassing Shared Key Authentication (SKA)</a></li><li><a href=#attacking-the-client>Attacking the client</a></li></ul></li></ul></li><li><a href=#wpa--wpa2>WPA / WPA2</a><ul><li><a href=#authentication-1>Authentication</a></li><li><a href=#attack>Attack</a><ul><li><a href=#clientless-attack>Clientless attack</a></li></ul></li></ul></li><li><a href=#wps>WPS</a><ul><li><a href=#brute-force>Brute Force?</a></li></ul></li></ul></nav></div></div><div class=content id=content><h1 id=attacking-wi-fi-networks-with-aircrack-ng>Attacking Wi-Fi networks with Aircrack-ng</h1><p>Before starting, remember that performing any of the attacks explained in this post to networks without previous consent is illegal, this post information is for educational purposes only.</p><h2 id=introduction>Introduction</h2><p>Wi-Fi uses management frames (datagrams are called frames in this context) and data frames. Only data frames are encrypted and injecting them into the network will require a previous association with the AP. This is not necessary for management frames or if we send data frames spoofing some of the clients MAC addresses.</p><p>About the hardware you will need, make sure your wireless card support monitor mode. Normally you will need a USB external adapter because internal cards won&rsquo;t allow you to use them in monitor mode but maybe you are lucky! Another thing to note is that in Kali or Parrot modified drivers that allow us to enable monitor mode in certain cards are already in place but these drivers should be installed manually in other distributions. There are cool resources to know what to buy out there, like lists of adapters or <a href="https://www.aircrack-ng.org/doku.php?id=compatibility_drivers" target=_blank rel="noopener noreffer">what to look for</a>.</p><h2 id=capturing-traffic>Capturing traffic</h2><p>Before explaining anything more, we need to prepare our network card to be able to capture Wi-Fi packages (monitor mode). It is possible to enable monitor mode with:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>airmon-ng start &lt;iface&gt;
</span></span></code></pre></td></tr></table></div></div><p>After that, you can now start capturing packages in the air. If the last command worked, you should have a new network interface called mon0, that is what you want to use here as interface:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>airodump-ng -c &lt;channel&gt; -w web_attack &lt;iface&gt;
</span></span></code></pre></td></tr></table></div></div><p>Locking a channel will reduce the noise so it is recommended (<code>-bssid</code> option can be used for reducing the noise even more).</p><h2 id=wep>WEP</h2><p>In this section we will try to learn a bit how WEP works and why it is so vulnerable and then explain how to perform several types of attacks against it.</p><h3 id=how-encryption-works>How encryption works?</h3><p>WEP uses a keystream to encrypt the traffic:</p><p style=background-color:#fff;padding-top:5px align=center><img width=75% height=75% src=images/wep-crypt-alt.svg alt="How WEP encryption works"></p><h3 id=authentication>Authentication</h3><p>The 802.11 specification describes three possible connection states for a client:</p><ol><li>Not authenticated</li><li>Authenticated but not associated</li><li>Authenticated and associated</li></ol><p>About how the authentication process work, the 802.11 original standard specified two authentication modes:</p><ul><li><strong>Open Authentication:</strong> If enabled, the client can just send an authentication request frame and the AP (Access point) will send an authentication result with a success state. After that, the association is performed. This mode can be abuse to perform a &ldquo;fake auth&rdquo; and being able to associate to an AP without the key.</li><li><strong>Shared Key Authentication (SKA):</strong> The AP send a challenge text (128 bytes) and the client has to encrypt it using a Initialization Vector (IV) and the key and send it back to the AP. The AP verifies that the challenge was correct and authenticate the client. The association process can be done after that. In this case, we can abuse that the challenge packages are sent in plaintext to capture the different packages to calculate a keystream we can use to associate to the AP and also inject packages without knowing the key.</li></ul><h3 id=main-flaws>Main flaws</h3><ul><li>Weak authentication scheme</li><li>Short initialization vector (IV) and subsequent frecuent reuse.</li><li>Vulnerable to replay attacks</li><li>Weak frame integrity protection thanks to the linearity of the CRC-32 field used as ICV (Integrity check value)</li><li>Low resistance to related key attacks enabling efficient statistical attacks. For this, it is necessary a certain amount of captured packages with different IVs.</li></ul><h3 id=attacks>Attacks</h3><h4 id=deauthentication-attack>Deauthentication Attack</h4><p>The idea is to send a management packet of type deauth with a MAC address to disconnect from the AP. This can be abused to increase network traffic (for key cracking), get the client connected to an evil twinn, capture the challenge process to get a keystream&mldr;</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>aireplay-ng -0 10 -c &lt;client_mac&gt; -a &lt;bssid&gt; &lt;iface&gt;
</span></span></code></pre></td></tr></table></div></div><h4 id=arp-replay-attacks>ARP Replay Attacks</h4><p>ARP Replay is the best way of generating more packages in the network to force the creation of new IVs. Once an ARP package is sniffed, it can be re-injected thanks to WEP lack of protection against this type of attacks.</p><p>Since ARP use broadcast messages, once we are able to re-inject an ARP package the AP will forward it to all the clients. This will generate new IVs for key cracking.</p><p>It is true that, since the network is encrypted, an attacker is not able to read the traffic but since the ARP packages have a fixed payload size of 36 bytes and always have the broadcast address set in the frame header (FF:FF:FF:FF:FF:FF), it is easy to identify them even encrypted.</p><p>To perform this attack, we will need to first associtate to the AP. This is how we can perform what is called a &ldquo;fake auth&rdquo; abusing open authentication:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>aireplay-ng -1 15 -a &lt;bssid&gt; -e &lt;ssid&gt; &lt;iface&gt;
</span></span></code></pre></td></tr></table></div></div><p>This also can be used instead to avoid getting deauthenticated by picky APs:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>aireplay-ng -1 6000 -q 10 -o 1 -a &lt;bssid&gt; -e &lt;ssid&gt; &lt;iface&gt;
</span></span></code></pre></td></tr></table></div></div><p>Now we can start the attack (Don&rsquo;t close the previous terminal!):</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>aireplay-ng -3 -b &lt;bssid&gt; &lt;iface&gt;
</span></span></code></pre></td></tr></table></div></div><h4 id=cracking-the-key-pwt-technique>Cracking the key (PWT technique)</h4><p>Everything we have seen is cool but I know we all want one thing: the AP key. For that we will use <code>aircrack-ng</code>.</p><p>For the tool to work, it needs network packages. 40 bits keys will need about 5000 IVs to be cracked and 104 bits keys could need aroud ten times more.</p><p>The command needs a password size and as you don&rsquo;t know the password length at the time of the attack, a good strategy is first trying with 64 bits and if it fails for more that 10000 IVs try with 128 bits. The default key size used is 128 bits (WEP-104).</p><p>Let&rsquo;s see how to start a cracking process over the packages we have captured before:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>aircrack-ng -n &lt;key_lengh&gt; -e &lt;target_ssid&gt; web_attack1*.cap
</span></span></code></pre></td></tr></table></div></div><p>The tool will start reading the captured packages and if the number of IVs is not enough, it will wait until we capture enough of them. Note that this technique only use captured ARP packages to improve the speed of the cracking process so you will need to launch an ARP replay attack in order to get enough IVs for this to work.</p><p>If everything goes well, you should get the AP key in hexadecimal format.</p><h5 id=korek-technique>KoreK technique</h5><p>You could want to use the old pre-PWT method to be able to use not only ARP packages when cracking the key. The problem is that you will need much more packages and this method is slower than PWT.</p><p>In order to use this method just add the <code>-K</code> flag to the <code>aircrack-ng</code> command.</p><h4 id=clientless-wep-cracking>Clientless WEP cracking</h4><p>Until now, all the attacks we saw need at least one client connected to the AP in order for them to work.</p><p>Let&rsquo;s see how we can get to the cracking step generating ARP packets without clients connected to the network:</p><ol><li>First authenticate to the AP to get associated to it:<div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>aireplay-ng -1 6000 -q 10 -a &lt;bssid&gt; &lt;iface&gt;
</span></span></code></pre></td></tr></table></div></div></li><li>Now we can launch the aireplay-ng fragmentation attack, the idea is to be able to get a keystream in order to start forging encrypted packets (make sure to use your wireless adapter MAC):<div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>aireplay-ng -5 -b &lt;bssid&gt; -c &lt;source_mac&gt; &lt;iface&gt;
</span></span></code></pre></td></tr></table></div></div>This will start capturing package until eventually a data frame is sent from the AP, at this point it will start trying to get a valid keystream. Make sure you are associated with the AP and also to be near enough in order for the attack to work.</li><li>Time to forge an ARP package now, this will create a package and save it into a file:<div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>packetforge-ng -0 -a &lt;bssid&gt; -h &lt;source_mac&gt; -k &lt;ip1&gt; -l &lt;ip2&gt; -y &lt;prga.xor&gt; -w outfile
</span></span></code></pre></td></tr></table></div></div>We could use 255.255.255.255 as both ip address and should be fine as most of the AP won&rsquo;t care. The prga thing is the keystream we got before.</li><li>Now we can use the package generated before to inject it into the network and start flooding the network to increase our IVs collection:<div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>aireplay-ng -2 -r &lt;packet_file&gt; &lt;iface&gt;
</span></span></code></pre></td></tr></table></div></div></li></ol><h4 id=bypassing-shared-key-authentication-ska>Bypassing Shared Key Authentication (SKA)</h4><p>All the authentication we did was using the open authentication method. This is not always enabled so let&rsquo;s see what we can do to bypass the SKA.</p><p>The idea is to capture the packets of a client during the authentication phase to get a keystream that we can use to not only to authenticate but also to forge packages. This is the attack steps (make sure you are capturing packages!):</p><ol><li>Deauthenticate one client.</li><li>Obtain the keystream from the captured authentication packages. If you are using <code>airdump-ng</code> this should happen automatically once a client authenticate to the AP, the keystream will be save in a <code>.xor</code> file.</li><li>Authenticate to the AP using the keystream:<div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>aireplay-ng -1 6000 -q 10 -e &lt;ssid&gt; -y &lt;file.xor&gt; &lt;iface&gt;
</span></span></code></pre></td></tr></table></div></div></li><li>Start the ARP replay attack, we can both forge an ARP package or wait for a client to send one for us.</li></ol><h4 id=attacking-the-client>Attacking the client</h4><p>Imagine now that you only have access to an AP client but not the AP itself, could we attack the client and get the AP key? Well, looks like this is possible!</p><p>Let&rsquo;s see how to perform the so-call Caffe-Latte attack, it is based in the fact that Wi-Fi clients that are roaming periodically send probes looking for an AP they know on every channel. As mutual authentication is not enforced by WEP we can mount a fake AP claiming to be the real one and the client will just connect to it.</p><p>Once the client is connected, it will probably send some free ARP packages and if we deauthenticate it to force a new connection we could start collecting packages again but this is slow and we don&rsquo;t want that.</p><p>The idea is, once we receive an ARP package from the client we can abuse the weak WEB integrity mechanism in order to flip bits in the package payload to get a valid ARP package that targets the client. Now we can just flood the client with ARP requests and start collecting IVs for free.</p><p>Time to start the attack, first of all we have to start <code>airdump-ng</code> as usual (locking it to one channel could be a good option since probes are sent to all channels). After that we can start our fake AP with the Caffe-Latte attack enabled with:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>airbase-ng -c &lt;channel&gt; -W 1 -L -e &lt;ssid&gt; &lt;iface&gt;
</span></span></code></pre></td></tr></table></div></div><p>Now we just have to wait until collecting enough packages to be able to crack the AP key. Another cool flag you can set is <code>-H</code> instead of -L, this will use an attack called Hirte (Instead of the Caffe-Latte one) that uses frame fragmentation to speed things up.</p><h2 id=wpa--wpa2>WPA / WPA2</h2><p>WPA/WPA2 are pretty secure and the attack surface is limited but let&rsquo;s see what can be done.</p><h3 id=authentication-1>Authentication</h3><p>The WPA/WPA2 authentication use a four-way handshake between the client and the AP, this process permits the mutual authentication between the AP (called Authenticator) and the client (called Supplicant). Both parts must know the PSK (pre-shared key) in order for the process to succeeds.</p><p>During the communication the PSK is never sent through the wireless medium. The PSK is only used to generate a PTK (Pairwise Transient Key) that is used as session-only encryption key. This is how the handshake works:</p><ol start=0><li>The shared key is used to generate the PMK (Pairwise Master Key). This key is 256 bits long and both the client and the AP independently calculate that key combining the PSK and SSID name.</li><li>The handshake starts now, the AP sends the client a message containing a nonce. In the WPA specification is called ANonce (Authenticator Nonce).</li><li>The client now generate another nonce, called SNonce (Supplicant Nonce), and builds the PTK concatenating the PMK, both nonces, the MAC addresses of AP and the client and everything is processed using a cryptographic hash function called PBKDF2-SHA1.</li><li>Now the client sends its SNonce to the AP so now also the AP can build the PTK. This message also contains a MIC (Message Integrity Code) which is used to authenticate the client.</li><li>The AP replies to the client with a message containing the GTK (Group Temporal Key) used to decrypt multicast and broadcast traffic. Also a MIC is sent to the client (This message is already encrypted).</li><li>Lastly, the client sends an ACK to end the authentication process.</li></ol><p style=background-color:#fff;padding-top:5px align=center><img width=75% height=75% src=images/4-way-handshake.svg alt="Image of the WPA 4 way handshake"></p><p>If you want to learn more about this part, I recommend <a href=https://www.wifi-professionals.com/2019/01/4-way-handshake target=_blank rel="noopener noreffer">this article</a>.</p><h3 id=attack>Attack</h3><p>The only way of attacking WPA is brute force, it is not fancy but is what we have. First we will need to capture a 4-way handshake, in order to that we can start capturing packages as we saw earlier and then deauthenticate a user from the target network. That way the client will try to connect back to the AP and we will get the handshake (Also we could just wait for a new client).</p><p>There is another method in order to obtain a handshake, <code>airbase-ng</code>. Remember when we use this tool for WEP? Well, thanks to how the WPA handshake works we can start a Rogue AP impersonating a SSID without knowing the password for it (The client send us the MIC in the second step so that is enough) and trick a user to connect to give us the handshake:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>airbase-ng -c &lt;channel&gt; -W 1 -Z 4 -e &lt;ssid&gt; &lt;iface&gt;
</span></span></code></pre></td></tr></table></div></div><p>The <code>-Z</code> option is used to specify WPA2 options and the <code>4</code> stands for CCMP encryption scheme.</p><p>You will know that a handshake was captured because <code>Airodump-ng</code> will notify you. Now is time for the cracking part, we could use a dictionay attack or a pure brute force attack. <code>aircrack-ng</code> could do the job but it is better if you transform the <code>.cap</code> file to a <code>.hccap</code> file and use Hashcat for better speeds.</p><p>If you prefer a rainbow table attack you can use <a href=https://github.com/JPaulMora/Pyrit target=_blank rel="noopener noreffer">Pyrit</a>. There are <a href=https://www.renderlab.net/projects/WPA-tables/ target=_blank rel="noopener noreffer">databases already prepared</a> to use on the internet if you prefer to skip the database building process.</p><h4 id=clientless-attack>Clientless attack</h4><p>If you are lucky, maybe the AP is vulnerable to what is called a PMKID attack. Basically, some APs with roaming features enabled would send to the client something called PMKID to make the re-association process faster.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>PMKID = HMAC-SHA1-128(PMK, &#34;PMK Name&#34; | MAC_AP | MAC_STA)
</span></span></code></pre></td></tr></table></div></div><p>This happens during the first part of the handshake so, an attacker, would be able to capture the PMKID to crack the PSK by just trying to associate to the AP without the interaction of any user. I wonÂ´t cover how to do this here because you need some extra stuff but you can find everything you need to know in <a href=https://hashcat.net/forum/thread-7717.html target=_blank rel="noopener noreffer">this hashcat article</a>.</p><h2 id=wps>WPS</h2><p>Wireless Protected Setup (WPS) was designed as a simple and secure method to setup a protected wireless network. WPS provides three different settup alternative methods:</p><ul><li>Push-Button-Connect</li><li>Internal-Registrar</li><li>External-Registrar</li></ul><p>The first two methods would need pyhisical or web interface access to the AP but the third option only requires the client to know a 8 digits number PIN.</p><h3 id=brute-force>Brute Force?</h3><p>Normally, brute forcing an 8 digits number will require testing for $10^8$ (=100.000.000) combinations but the actual form of authentication used by WPS reduces this number.</p><p>The WPS PIN is divided into two halves of 4 digits each. The last digit of the second half is a checksum meaning it is always calculated from the other digits. The authentication process works like this:</p><ol><li>Both AP and client initialize keys and internal state.</li><li>Client provides first half of the PIN.</li><li>Client provides second half of the PIN.</li><li>AP sends network configuration, including the network password.</li></ol><p>The AP will send a NACK packet, terminating the process, if the step 2 or 3 fail. That allow us to perform a pretty efficient brute force attack:</p><ol><li>We start brute forcing the first half of the PIN incrementing the number to try each time.</li><li>Once we get to the third step of the authentication process we can repeat the process again with the second half of the PIN.</li><li>Enjoy your network access!</li></ol><p>With this approach, we reduced the number of combinations to try to 20.000 (=$10^4$ + $10^4$). If we also take into account that the last digit it is just a checksum value, the number of combinations is even smaller: $10^4$ + $10^3$ (=11.000).</p><p>There are two tools that can help to exploit this:</p><ul><li><a href=https://code.google.com/archive/p/reaver-wps/ target=_blank rel="noopener noreffer">Reaver</a></li><li><a href=https://github.com/aanarchyy/bully target=_blank rel="noopener noreffer">Bully</a></li></ul><p>We will be using Bully for the brute force attack and a tool called Wash included in Reaver that will allow us to detect vulnerable APs. To start looking for vulnerable APs let&rsquo;s launch Wash:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>wash -i mon0
</span></span></code></pre></td></tr></table></div></div><p>This command also will show if the AP has blocked WPS access due to internal anti-bruteforce protection (This is the major limitation of this attack). In order to start the attack just execute:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>bully -b &lt;bssid&gt; &lt;interface&gt;
</span></span></code></pre></td></tr></table></div></div><p>The AP could block WPS after certain failed attempts, to try to avoid this we could add more delay between tries (But this is not perfect). There is an attack called <a href=https://www.quora.com/How-does-a-WPS-pixie-attack-work target=_blank rel="noopener noreffer">Pixie Dust</a>, it is offline and if the AP is vulnerable you could get the PIN in just minutes thanks to a problem with the random generation of nonces used. Bully offers this attack too with the <code>-d</code> flag so use it if possible to improve your chances.</p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>Updated on 2022-12-25</span></div></div><div class=post-info-line><div class=post-info-md><span><a class=link-to-markdown href=/attacking-wi-fi-networks-with-aircrack-ng/index.md target=_blank>Read Markdown</a></span></div><div class=post-info-share><span><a href=javascript:void(0); title="Share on Twitter" data-sharer=twitter data-url=https://blog.anthares101.com/attacking-wi-fi-networks-with-aircrack-ng/ data-title="Attacking Wi-Fi networks with Aircrack-ng" data-via=@Anthares101 data-hashtags="wifi,red team,network"><i class="fab fa-twitter fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Facebook" data-sharer=facebook data-url=https://blog.anthares101.com/attacking-wi-fi-networks-with-aircrack-ng/ data-hashtag=wifi><i class="fab fa-facebook-square fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Linkedin" data-sharer=linkedin data-url=https://blog.anthares101.com/attacking-wi-fi-networks-with-aircrack-ng/><i class="fab fa-linkedin fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw" aria-hidden=true></i>&nbsp;<a href=/tags/wifi/>wifi</a>,&nbsp;<a href=/tags/red-team/>red team</a>,&nbsp;<a href=/tags/network/>network</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>Back</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span></section></div><div class=post-nav><a href=/magi-project/ class=prev rel=prev title="MAGI Project"><i class="fas fa-angle-left fa-fw" aria-hidden=true></i>MAGI Project</a>
<a href=/dns-tunneling/ class=next rel=next title="DNS tunneling">DNS tunneling<i class="fas fa-angle-right fa-fw" aria-hidden=true></i></a></div></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><i class="far fa-copyright fa-fw" aria-hidden=true></i><span itemprop=copyrightYear>2023</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=/posts/ target=_blank>Anthares101</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i>
</a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.css><script type=text/javascript src=https://cdn.jsdelivr.net/npm/autocomplete.js@0.38.1/dist/autocomplete.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lunr@2.3.9/lunr.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/auto-render.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/copy-tex.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/mhchem.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"Copy to clipboard",maxShownLines:50},comment:{},math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!0,left:"\\begin{equation}",right:"\\end{equation}"},{display:!0,left:"\\begin{equation*}",right:"\\end{equation*}"},{display:!0,left:"\\begin{align}",right:"\\end{align}"},{display:!0,left:"\\begin{align*}",right:"\\end{align*}"},{display:!0,left:"\\begin{alignat}",right:"\\end{alignat}"},{display:!0,left:"\\begin{alignat*}",right:"\\end{alignat*}"},{display:!0,left:"\\begin{gather}",right:"\\end{gather}"},{display:!0,left:"\\begin{CD}",right:"\\end{CD}"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},search:{highlightTag:"em",lunrIndexURL:"/index.json",maxResultLength:10,noResultsFound:"No results found",snippetLength:30,type:"lunr"}}</script><script type=text/javascript src=/js/theme.min.js></script></body></html>